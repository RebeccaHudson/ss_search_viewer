{% load staticfiles %}
<head>
  <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>atsnp data</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <link href="{% static 'ss_viewer/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'ss_viewer/custom.css' %}" rel="stylesheet">
</head>
<body>

<div class="container-fluid">
<div id="content">

<h2 >Search atSNP output</h2>
<div id="status_message"> {{ status_message }} </div>

<div class="side"> 

<ul id="tabs" class="nav nav-tabs" data-tabs="tabs">


  <li  {%if active_tab == 'snpid' or active_tab == 'none-yet'%}class="active"{%endif%}><a href="#snpid_search_form" data-toggle="tab"  >SNPid List</a></li>

  <li {%if active_tab == 'snpid-window'%}class="active"{%endif%}><a href="#snpid_window_form" data-toggle="tab" >SNPid Window</a></li>

  <li {%if active_tab == 'gl-region' %}
      class="active"
      {% endif %}><a href="#gl_region_search_form" data-toggle="tab">Genomic Location</a></li>

  <li {%if active_tab == 'gene-name'%}class="active"{%endif%}><a href="#gene_name_form" data-toggle="tab" >Gene</a></li>

  <li {%if active_tab == 'tf'%}class="active"{%endif%}><a href="#tf_search_form" data-toggle="tab" >Transcription Factor</a></li>





</ul>



<div id="tabbed-forms" class="tab-content">

<div class="tab-pane panel-body 
   {%if active_tab == 'gl-region' %} active{%endif%}" id="gl_region_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:gl-region-search' %}" method="post" >
  {% csrf_token %}
  <div class="form-group">
    <table>
      {{ gl_search_form.as_table }}
    </table>

    <div class="submit-buttons">
        <input type="submit" name="action" value="Search by Genomic Location"  class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'gl-region' %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
    </div><!-- end div for submit buttons. -->
    <button id="gl-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
  </div>
     {% if search_paging_info != None and active_tab == 'gl-region' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n if the dataset is > 60000 rows,only the first 60,000 rows will be downloaded.')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'snpid' or active_tab == 'none-yet'%} active{%endif%}"  id="snpid_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:snpid-search' %}" method="post">
  {% csrf_token %}
  <div class="form-group">
    <table>
      {{ snpid_search_form.as_table }}

    </table>

    <div class="submit-buttons">

      <input type="submit" name="action" value="Search by SNPid"  class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'snpid' %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
    </div><!-- end div for submit buttons. -->
    <button id="snpid-search-demo" type="button" class="btn btn-link">Use demo values for search.</button>
  </div>
     {% if search_paging_info != None and active_tab = 'snpid' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n if the dataset is > 60000 rows,only the first 60,000 rows will be downloaded.')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'tf'%} active{%endif%}"  id="tf_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:trans-factor-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ tf_search_form.as_table }}
      </table>

      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Transcription Factor"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'tf'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
    
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
       </div><!-- end div for submit buttons. -->
    <button id="tf-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None and active_tab == 'tf' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n if the dataset is > 60000 rows,only the first 60,000 rows will be downloaded.')" />
     {% endif %}

  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'snpid-window'%} active{%endif%}"  id="snpid_window_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:snpid-window-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ snpid_window_form.as_table }}
      </table>

      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Window around SNPid"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'snpid-window'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
       </div><!-- end div for submit buttons. -->
       <button id="snpid-window-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None  and active_tab == 'snpid-window' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n if the dataset is > 60000 rows,only the first 60,000 rows will be downloaded.')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'gene-name'%} active{%endif%}"  id="gene_name_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:gene-name-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ gene_name_form.as_table }}
      </table>
      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Gene Name"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'gene-name'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
      </div> <!-- end div for submit buttons. -->
       <button id="gene-name-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None and active_tab == 'gene-name' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n if the dataset is > 60000 rows,only the first 60,000 rows will be downloaded.')" />
     {% endif %}
  </form>
</div>
 

 
</div> <!-- close the 'side' div -->

</div> <!-- close the 'tabbed forms' div -->
<!--  this is the way that we will be displaying the plot -->
{% if plot_source %}
<div class="side plot">
    {% if plot_source %}
        {% for plot_id_str, one_svg in plot_source.items %}
          <div id="plot_{{plot_id_str}}" class="{% if plot_id_str == first_plot_id_str %}show-plot{% else %}hide-plot{% endif %}" > 
              <!-- <p> {{ plot_id_str }} </p>   -->
              <a href="{{ one_svg }}"><img title="Click image for a full-sized version." src="{{ one_svg }}" alt="current plot"></a>
          </div>
        {% endfor %}
    {% endif %}
</div>
{% endif %}

<!-- consider making this part modular; DRYing it up some how... -->
  {% if api_response  %}
  <table class="table table-striped table-condensed"> 
    <thead>
    <tr>

        <td><a href="{% url 'ss_viewer:help-page' %}#snpid">SNPid                   </a>       </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#chromosome">Chromosome              </a>  </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#position">Position                </a>    </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#ref_allele">Reference Allele        </a>  </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#snp_allele">SNP Allele              </a>  </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#pval_rank" >p-value Rank            </a>  </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#log_lik_ref">Log Likelihood Reference</a> </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#log_lik_snp">Log Likelihood SNP      </a> </td>  
        <td><a href="{% url 'ss_viewer:help-page' %}#log_lik_ratio">Log Likelihood Ratio   </a> </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#pval_ref">    p-value Reference       </a> </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#pval_snp">p-value SNP              </a>    </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#pval_diff">p-value Difference       </a>   </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#trans_factor">Transcription Factor </a>   </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#motif"> Motif                </a>         </td>
        <td><a href="{% url 'ss_viewer:help-page' %}#has_plot">Plot Available     </a>         </td>

        <!-- 
        <td>motif length</td>
        <td>snp start</td>
        <td>snp end</td>
        <td>ref start</td>
        <pi><td>ref end</td>
        <td>log enhance odds</td>
        <td>log reduce odds</td>
        <td> snp strand </td>
        <td> ref strand </td>
        <td>pval cond ref</td>
        <td> pval cond snp</td> -->
    </tr>
    </thead>
    <tbody>
    {% for onerow in api_response %}
    <tr>   
        <td> {{ onerow.snpid }}</td>
        <td> {{ onerow.chr }}</td>
        <td> {{ onerow.pos }}</td> 
        <td> {{ onerow.refAllele }}</td> 
        <td> {{ onerow.snpAllele }}</td> 
        <td> {{ onerow.pval_rank|stringformat:".3e"}} </td>
        <td> {{ onerow.log_lik_ref|stringformat:".3e"}} </td>
        <td> {{ onerow.log_lik_snp|stringformat:".3e"}} </td>  
        <td> {{ onerow.log_lik_ratio|stringformat:".3e"}} </td>
        <td> {{ onerow.pval_ref|stringformat:".3e" }} </td>
        <td> {{ onerow.pval_snp|stringformat:".3e" }} </td>
        <td> {{ onerow.pval_diff|stringformat:".3e" }}</td>  

        <td> {{ onerow.trans_factor }}</td>
        <td> {{ onerow.motif }} </td>
        <td class="show_plots" > {% if onerow.has_plot %}
                  <button id="show_plot_{{onerow.plot_id_str}}" 
                          type="button" class="btn btn-link" 
                          plotstr="{{onerow.plot_id_str}}"
                          title="Show the plot for this data."> 
                  Show Plot</button>{% else %} N/A {% endif %}</td> 
       </tr>
    {%  endfor %}
    <tbody>
  </table>
  {% endif %}


</div> <!-- close the 'content' div -->
</div> <!-- close the 'container' div -->

    <script src="{% static 'ss_viewer/js/bootstrap.min.js' %}"></script>

<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $('#tabs').tab();
        $('#id_encode_trans_factor').attr('disabled', 'disabled');
        $('#id_tf_library_0').attr('checked', 'checked');
        $('#id_tf_library_1').removeAttr('checked');

        $('#id_tf_library').change(function(e){
             var target_val = e.target.attributes.getNamedItem('value');
             if (target_val.value == 'encode'){
                $("#id_trans_factor").attr('disabled', 'disabled');
                /*$("#id_trans_factor").val(''); */

                $("#id_encode_trans_factor").removeAttr('disabled'); }
                /*$("#id_encode_trans_factor").val("AR"); */
                alert("clicked encode");
             if ( target_val.value == 'jaspar'){

                $("#id_encode_trans_factor").attr('disabled', 'disabled');
                /*$("#id_encode_trans_factor").val('');*/

                $("#id_trans_factor").removeAttr('disabled');
                /*$("#id_trans_factor").val("AT1");*/
                alert("clicked jaspar");
               }
         });
   


        $("#snpid-search-demo").click(function(e){ 
                                       $('#id_raw_requested_snpids').val(
                                             'rs539483321, rs576894892, rs553761389, rs757299236, rs770590115');
                                        } );
        $("#gl-search-demo").click(function(e){
                                       $('#id_gl_start_pos').val(10000);
                                       $('#id_gl_end_pos').val(143511163);
                                       $('#id_selected_chromosome').val('ch5'); });
        $("#tf-search-demo").click(function(e){
                                      $('#id_trans_factor').val('NFYB'); });
        $("#snpid-window-search-demo").click(function(e){
                                      $('#id_snpid').val('rs755632525'); });
        $("#gene-name-search-demo").click(function(e){
                                      $('#id_gene_name').val('NM_001293798'); });
        /*$("#show_plot").click(function(e){ */
        $("td.show_plots > button").click(function(e) {
                                var plotstr_attr = e.target.attributes.getNamedItem('plotstr');
                                var plot_str  = plotstr_attr.value;

                                /* hides the currently shown plot */
                                var currently_shown_plot = $("div.show-plot");
                                currently_shown_plot.removeClass('show-plot');
                                currently_shown_plot.addClass('hide-plot'); 
                                var id_of_plot_div = 'plot_'.concat(plot_str); 
                                var plot_selector = '#'.concat(id_of_plot_div);
                                var div_to_show_now = $(plot_selector);
                                div_to_show_now.removeClass('hide-plot');
                                div_to_show_now.addClass('show-plot');
                                window.scrollTo(0, 0); 
                               }); 
       $("#id_file_of_snpids").click(function(e)  { $("#id_raw_requested_snpids").val(""); }); 
    });
</script>
<script>
 $(".formcontrol").tooltip({
      position: "bottom left",
      offset: [-2, 10],
      opacity: 0.1
      });
</script>


</body>
