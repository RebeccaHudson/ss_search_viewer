{% load staticfiles %}
<head>
  <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>atsnp data</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <link href="{% static 'ss_viewer/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'ss_viewer/custom.css' %}" rel="stylesheet">
</head>
<body>

<div class="container-fluid">
<div id="content">

<h2 >Search ATSNP output</h2>
<div id="status_message"> {{ status_message }} </div>

<div class="side"> 

<ul id="tabs" class="nav nav-tabs" data-tabs="tabs">

  <li {%if active_tab == 'gl-region' or active_tab == 'none-yet'  %}
      class="active"
      {% endif %}><a href="#gl_region_search_form" data-toggle="tab">Genomic Location</a></li>

  <li  {%if active_tab == 'snpid'%}class="active"{%endif%}><a href="#snpid_search_form" data-toggle="tab"  >SNPid</a></li>

  <li {%if active_tab == 'tf'%}class="active"{%endif%}><a href="#tf_search_form" data-toggle="tab" >Transcription Factor</a></li>

  <li {%if active_tab == 'snpid-window'%}class="active"{%endif%}><a href="#snpid_window_form" data-toggle="tab" >Snpid Window</a></li>

  <li {%if active_tab == 'gene-name'%}class="active"{%endif%}><a href="#gene_name_form" data-toggle="tab" >Gene Name</a></li>

</ul>



<div id="tabbed-forms" class="tab-content">

<div class="tab-pane panel-body 
   {%if active_tab == 'gl-region' or active_tab == 'none-yet'%} active{%endif%}" id="gl_region_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:gl-region-search' %}" method="post" >
  {% csrf_token %}
  <div class="form-group">
    <table>
      {{ gl_search_form.as_table }}
    </table>

    <div class="submit-buttons">
        <input type="submit" name="action" value="Search by Genomic Location"  class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'gl-region' %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
    </div><!-- end div for submit buttons. -->
    <button id="gl-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
  </div>
     {% if search_paging_info != None and active_tab == 'gl-region' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n and large datasets WILL be truncated. Some restrictions may apply.\n Are you sure you want this download?')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'snpid'%} active{%endif%}"  id="snpid_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:snpid-search' %}" method="post">
  {% csrf_token %}
  <div class="form-group">
    <table>
      {{ snpid_search_form.as_table }}

    </table>

    <div class="submit-buttons">

      <input type="submit" name="action" value="Search by SNPid"  class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'snpid' %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
    </div><!-- end div for submit buttons. -->
    <button id="snpid-search-demo" type="button" class="btn btn-link">Use demo values for search.</button>
  </div>
     {% if search_paging_info != None and active_tab = 'snpid' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n and large datasets WILL be truncated. Some restrictions may apply.\n Are you sure you want this download?')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'tf'%} active{%endif%}"  id="tf_search_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:trans-factor-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ tf_search_form.as_table }}
      </table>

      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Transcription Factor"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'tf'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
    
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
       </div><!-- end div for submit buttons. -->
    <button id="tf-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None and active_tab == 'tf' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n and large datasets WILL be truncated. Some restrictions may apply.\n Are you sure you want this download?')" />
     {% endif %}

  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'snpid-window'%} active{%endif%}"  id="snpid_window_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:snpid-window-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ snpid_window_form.as_table }}
      </table>

      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Window around SNPid"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'snpid-window'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
       </div><!-- end div for submit buttons. -->
       <button id="snpid-window-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None  and active_tab == 'snpid-window' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n and large datasets WILL be truncated. Some restrictions may apply.\n Are you sure you want this download?')" />
     {% endif %}
  </form>
</div>


<div class="tab-pane panel-body
   {%if active_tab == 'gene-name'%} active{%endif%}"  id="gene_name_form" >
  <form role="form" enctype="multipart/form-data" action="{% url 'ss_viewer:gene-name-search' %}" method="post">
  {% csrf_token %}
    <div class="form-group">
      <table>
        {{ gene_name_form.as_table }}
      </table>
      <div class="submit-buttons">
          <input type="submit" name="action" value="Search by Gene Name"  
                                                          class="btn btn-primary" />
          {% if search_paging_info != None and active_tab == 'gene-name'  %}
            {% if search_paging_info.show_next_btn == True %}
                <input type="submit" name="action" value="Next" class="btn btn-info" /> 
            {% endif %}
            
            {% if search_paging_info.show_prev_btn == True %}
                <input type="submit" name="action" value="Prev"  class="btn btn-info" /> 
            {% endif %}
          {% endif %}
      </div> <!-- end div for submit buttons. -->
       <button id="gene-name-search-demo" type="button" class="btn btn-link" title="Fill out the form with demo values."> Use demo values for search.</button>
    </div>

     {% if search_paging_info != None and active_tab == 'gene_name' %}
       <input type="submit" name="action" 
         value="Download Results" class="btn-xs btn-danger"
         onclick="return confirm('Downloads can take a while,\n and large datasets WILL be truncated. Some restrictions may apply.\n Are you sure you want this download?')" />
     {% endif %}
  </form>
</div>
 

 
</div> <!-- close the 'side' div -->

</div> <!-- close the 'tabbed forms' div -->
<!--  this is the way that we will be displaying the plot -->
<div class="side plot">
    {% if plot_source %}
        {% for plot_id_str, one_svg in plot_source.items %}
          <div id="plot_{{plot_id_str}}" class="{% if plot_id_str == first_plot_id_str %}show-plot{% else %}hide-plot{% endif %}" > 
              <!-- <p> {{ plot_id_str }} </p>   -->
              <a href="{{ one_svg }}"><img title="Click image for a full-sized version." src="{{ one_svg }}" alt="truckin-plot"></a>
          </div>
        {% endfor %}
    {% endif %}
</div>


<!-- consider making this part modular; DRYing it up some how... -->
  {% if api_response  %}
  <table class="table table-striped table-condensed"> 
    <thead>
    <tr>
        <td>chromosome</td>
        <td>pos</td>
        <td>snpid</td>
        <td>transcription factor</td>
        <td>motif</td>
       <td>motif length</td>
        <td>pval rank</td>
        <td>snp start</td>
        <td>snp end</td>
        <td>ref start</td>
        <td>ref end</td>
        <td>log lik ref</td>
        <td> log lik ratio </td>
        <td>log enhance odds</td>
        <td>log reduce odds</td>
        <td> log lik snp</td>  
        <td> snp strand </td>
        <td> ref strand </td>
        <td> pval ref</td>
        <td> pval snp</td>
        <td>pval cond ref</td>
        <td> pval cond snp</td>
        <td> pval diff</td>
        <td> ref allele </td>

        <td> snp allele </td>
        <td> has plot</td>
    </tr>
    </thead>
    <tbody>
    {% for onerow in api_response %}
    <tr>   
        <td>{{ onerow.chr }}</td><td>{{ onerow.pos }}</td> 
        <td>{{ onerow.snpid }}</td><td> {{ onerow.trans_factor }}</td>
        <td> {{ onerow.motif }} </td> <td>{{ onerow.motif_len}}</td>
        <td>  {{ onerow.pval_rank|stringformat:".3e"}} </td>
        <td>{{ onerow.snp_start}} </td><td>{{ onerow.snp_end}}</td><td>{{ onerow.ref_start}}</td>
        <td>{{ onerow.ref_end }} </td>
         <td>{{ onerow.log_lik_ref|stringformat:".3e"}} </td><td> {{ onerow.log_lik_ratio|stringformat:".3e"}} </td>
        <td>{{ onerow.log_enhance_odds|stringformat:".3e"}}</td><td>{{onerow.log_reduce_odds|stringformat:".3e"}} </td>
        <td>{{ onerow.log_lik_snp|stringformat:".3e"}} </td>  
        <td>{{ onerow.snp_strand }}</td>  <td>{{ onerow.ref_strand }}</td>
        <td>{{ onerow.pval_ref|stringformat:".3e" }} </td><td>{{ onerow.pval_snp|stringformat:".3e" }} </td>
        <td>{{ onerow.pval_cond_ref|stringformat:".3e" }}</td> <td>{{ onerow.pval_cond_snp|stringformat:".3e"}}</td>
        <td>{{ onerow.pval_diff|stringformat:".3e" }}</td>  
        <td> {{ onerow.refAllele }}</td> 
       <td> {{ onerow.snpAllele }}</td> 
       <td class="show_plots" > {% if onerow.has_plot %}
                  <button id="show_plot_{{onerow.plot_id_str}}" 
                          type="button" class="btn btn-link" 
                          plotstr="{{onerow.plot_id_str}}"
                          title="Show the plot for this data."> 
                  Show Plot</button>
            {% else %}
               N/A
            {% endif %} 
       </td> </tr>
    {%  endfor %}
    <tbody>
  </table>
  {% endif %}


</div> <!-- close the 'content' div -->
</div> <!-- close the 'container' div -->

    <script src="{% static 'ss_viewer/js/bootstrap.min.js' %}"></script>

<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $('#tabs').tab();
        $("#snpid-search-demo").click(function(e){ 
                                       $('#id_raw_requested_snpids').val(
                                             'rs539483321, rs576894892, rs553761389, rs757299236, rs770590115');
                                        } );
        $("#gl-search-demo").click(function(e){
                                       $('#id_gl_start_pos').val(10000);
                                       $('#id_gl_end_pos').val(143511163);
                                       $('#id_selected_chromosome').val('ch5'); });
        $("#tf-search-demo").click(function(e){
                                      $('#id_trans_factor').val('NFYB'); });
        $("#snpid-window-search-demo").click(function(e){
                                      $('#id_snpid').val('rs755632525'); });
        $("#gene-name-search-demo").click(function(e){
                                      $('#id_gene_name').val('NM_001293798'); });
        /*$("#show_plot").click(function(e){ */
        $("td.show_plots > button").click(function(e) {
                                var plotstr_attr = e.target.attributes.getNamedItem('plotstr');
                                var plot_str  = plotstr_attr.value;

                                /* hides the currently shown plot */
                                var currently_shown_plot = $("div.show-plot");
                                currently_shown_plot.removeClass('show-plot');
                                currently_shown_plot.addClass('hide-plot'); 
                                var id_of_plot_div = 'plot_'.concat(plot_str); 
                                var plot_selector = '#'.concat(id_of_plot_div);
                                var div_to_show_now = $(plot_selector);
                                div_to_show_now.removeClass('hide-plot');
                                div_to_show_now.addClass('show-plot');
                               }); 
    });
</script>
<script>
 $(".formcontrol").tooltip({
      position: "bottom left",
      offset: [-2, 10],
      opacity: 0.1
      });
</script>


</body>
