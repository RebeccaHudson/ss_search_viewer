{% load staticfiles %}
<head>
  <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>atSNP Search</title>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <link href="{% static 'ss_viewer/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'ss_viewer/custom.css' %}" rel="stylesheet">
  <link href="{% static 'ss_viewer/plot-styles.css' %}" rel="stylesheet"> 
  <link href="{% static 'ss_viewer/search-page-styles.css' %}" rel="stylesheet"> 

  <script src="http://d3js.org/d3.v3.min.js"></script>
   
   <script type="text/javascript" src="{% static 'ss_viewer/cloneTheSkeleton.js' %}"> </script>  
   <script type="text/javascript" src="{% static 'ss_viewer/plotIntoSVGSkeleton.js' %}"> </script> 
   <script type="text/javascript" src="{% static 'ss_viewer/plotIntoSVG-shrinky-plots.js' %}"> </script>
   <script type="text/javascript" src="{% static 'ss_viewer/spin.min.js' %}"> </script> 
   <script type="text/javascript" src="{% static 'ss_viewer/setupSearchDemos.js' %}"> </script> 
   <script type="text/javascript" src="{% static 'ss_viewer/setupCSRF.js' %}"> </script> 
   <script type="text/javascript" src="{% static 'ss_viewer/js/dist/jszip.min.js' %}"></script>
   <script type="text/javascript" src="{% static 'ss_viewer/js/FileSaver.min.js' %}"></script>
   <script type="text/javascript" src="{% static 'ss_viewer/setupBulkPlotDownloads.js' %}"></script>

   <!-- Code for showing search results. -->

   <script type="text/javascript" src="{% static 'ss_viewer/ajaxyPosts.js' %}"></script>

   <!-- ajaxy posts contains code for creating AJAXy posts for searches, paging, and CSV downloads -->
   <script type="text/javascript" src="{% static 'ss_viewer/searchControl.js' %}"></script>
   <!-- searchControl.js contains code for setting up the AJAXy form submitssions,
           paging, hiding/showing controls -->

   <script type="text/javascript" src="{% static 'ss_viewer/plots.js' %}"></script>
   <!-- plots.js contains all code for drawing plots  -->

   <script type="text/javascript" src="{% static 'ss_viewer/sort-widget.js' %}"></script>

   <!-- keep the snpidFile input consistent; make the 'clear' button appear and disappear.-->
   <script type="text/javascript" src="{% static 'ss_viewer/snpidFileInputControls.js' %}"></script>

   <script type="text/javascript" src="{% static 'ss_viewer/directional.js' %}"></script>



</head>
<body>
<div class="container">
<div id="content">
{% include "ss_viewer/navbar.html" with active='searches' %}

<div id="flex">
  <div id="search" class="side"> 

  <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
    <li  {%if active_tab == 'snpid' or active_tab == 'none-yet'%}class="active"{%endif%}><a href="#snpid_search_form" data-toggle="tab"  >SNPid List</a></li>
    <li {%if active_tab == 'snpid-window'%}class="active"{%endif%}><a href="#snpid_window_form" data-toggle="tab" >SNPid Window</a></li>
    <li {%if active_tab == 'gl-region' %}
        class="active"
        {% endif %}><a href="#gl_region_search_form" data-toggle="tab">Genomic Location</a></li>
    <li {%if active_tab == 'gene-name'%}class="active"{%endif%}><a href="#gene_name_form" data-toggle="tab" >Gene</a></li>
    <li {%if active_tab == 'tf'%}class="active"{%endif%}><a href="#tf_search_form" data-toggle="tab" >Transcription Factor</a></li>
  </ul>


  <div id="tabbed-forms" class="tab-content">
  {% include "ss_viewer/gl_search.html" %} 
  {% include "ss_viewer/snpid_search.html" %}
  {% include "ss_viewer/trans_factor_search.html" %}
  {% include "ss_viewer/snpid_window_search.html" %}
  {% include "ss_viewer/gene_name_search.html" %}
   <!-- if the nav tab ends here, you can independently scroll the search results -->
  </div> <!-- close the 'tabbed forms' div -->
  </div> <!-- close the 'side' div -->

   <!-- begin downloads div -->
   <div id="infobox">
   <div class="explain" id="search-exp"> <!-- contains information about each search type when its tab is active -->
     <p class="explain-search" id="snpid_search_form-explain">
       Please type SNPids of interest in the box or upload a text file 
       containing a list of SNPids.
       Significant motif matches reaching the p-value cutoff will be returned.
     </p>
     <p class="explain-search" id="snpid_window_form-explain">
       Please type a SNPid of interest and a window size (number of base pairs)
       around the SNP.
       atSNP grabs all SNPs located in the region and finds SNP-motif 
       combinations reaching the p-value cutoff. 
     </p>
     <p class="explain-search" id="gl_region_search_form-explain"> 
       Please specify a genomic region of interest by typing its start and
       end position, and selecting the chromosome.
       The region starts at 0 or 1 (?). atSNP grabs all SNPs located in the
       region and finds SNP-motif combinatinos reaching the p-value cutoff.
     </p>
     <p class="explain-search" id="gene_name_form-explain">
       Please type a gene symbol name and a window size to which you want to 
       extend a region of interest around the gene.
       atSNP grabs all SNPs located in the region and finds SNP-motif 
       combinations reaching the p-value cutoff. 
     </p>
     <p class="explain-search" id="tf_search_form-explain">
       Please select a transcription factor library to use, then select a 
       transcription factor of interest. JASPAR and encode information is
       available <a href="{% url 'ss_viewer:help-page' %}#part-1:part-1">
       here</a>. atSNP shows all SNPs having a statistically significant impact
       on the binding of the transcription factor at the p-value cutoff.
     </p>
   </div> <!-- end of 'search-exp' div -->
   <div class="explain" id="download-exp" >
         <div>
           <p> Numeric data for the search results shown here can be downloaded in CSV
             format. 
            <div id="download_button" >
              <input type="submit" name="action"
                     value="Download Results"
                     class="btn-xs btn-danger"
                     onclick="clickDownloadResultsAJAX();" />
            </div>
           </p>
         </div>
         <div>
            <p> 
              A ZIP archive of PNG images for plots of the data on this page can be 
              downloaded. To include plots in this download, check the boxes in the
              rightmost column of the search results. Shortcuts to checking or unchecking
              all of these boxes are available below the plot Download Button.<br />
              <span style="font-size:10px;">
                (Single plots can also be downloaded from the Details view for each row of data.)
              </span>
              <div id="download_plots_for_checked_rows" >
                  <!-- TODO: put an alert indicating there's no darn rows checked -->
                  <input type="submit" name="checkedRowPlotDownload"
                         value="Download Plots for Checked Rows"
                         class="btn-xs"
                         onclick="checkedRowPlotDownload();" />
              </div>
           </p>
                  <input type="submit" name="checkAllBoxes"
                         value="Add All Plots on Page to Download"
                         class="btn-xs btn-link"
                         onclick="hitAllPlotCheckboxes(true);" />
                  <input type="submit" name="uncheckAllBoxes"
                         value="Remove All Plots on Page From Download"
                         class="btn-xs btn-link"
                         onclick="hitAllPlotCheckboxes(false);" />
        </div>
   </div>
   <!-- end downloads div -->
  </div> <!-- end the 'info box' div -->
<!-- end 'flex' div -->
</div>


<!--  this is the way that we will be displaying the plot -->
<div class="side plot">
   <div id="plots">
   {% include "ss_viewer/svg_skeleton.html" %}
   {% include "ss_viewer/fixed_width_cl_plot.html" %}
   </div>

</div>
<canvas id="canvas" style="display:none;" width="800" height="370"></canvas>

<!-- this div will contain the search params to submit for paging -->
<div id='current_search_params' style="display:none;">
</div>

<span id='type_of_shown_results' style="display:none;" >
{% if active_tab  %}
  {{ active_tab }} 
{% endif %}
</span>



<div class="status_message" id="status_above"> {{ status_message }} </div>
<!-- Errors will be reported here when they are returned from AJAX requests -->
<div id="form_errors">
</div>

<div id="drop-in" class="scroll">
</div>
<br />

<div class="status_message"  id="status_below" style="display: none;"> {{ status_message }} </div>
<div id="ajaxyPagingButtons" >
     <button type="button"
             onclick='pagingAJAX("Prev");'
             style="display:none;"
             id="prev_button">
            <span class="glyphicon glyphicon-chevron-left"></span>
             Previous</button>
     <button type="submit" 
             onclick='pagingAJAX("Next");'
             style="display:none;"
             id="next_button">Next
             <span class="glyphicon glyphicon-chevron-right"></span>
             </button>
</div>




</div> <!-- close the 'content' div -->
</div> <!-- close the 'container' div -->

<!-- TODO: ensure this is handled in <head> and get it out of here. -->
<script src="{% static 'ss_viewer/js/bootstrap.min.js' %}"></script>

<script type="text/javascript">
    jQuery(document).ready(function ($) {

        $('#tabs').tab();

        /* (for searches by TF) have JASPAR selected by default */
            $('#id_encode_trans_factor').attr('disabled', 'disabled');
            $('#id_tf_library_0').attr('checked', 'checked');
            $('#id_tf_library_1').removeAttr('checked');

        /* enable and disable the Transcription Factor selectors based 
           on which one the user is going to search*/
        $('#id_tf_library').change(function(e){
             var target_val = e.target.attributes.getNamedItem('value');
             if (target_val.value == 'encode'){
                $("#id_trans_factor").attr('disabled', 'disabled');
                $("#id_encode_trans_factor").removeAttr('disabled'); }
             if ( target_val.value == 'jaspar'){
                $("#id_encode_trans_factor").attr('disabled', 'disabled');
                $("#id_trans_factor").removeAttr('disabled');
               }
         });
      setupSearchDemos();
      drawPlotsInline();
      setupAjaxyFormSubmissions(); //Event listeners to submit forms asynchronously. 
      setupSNPidFileControls();
      writeBothCutoffDirections();
    });//end of document.ready stuff.

    $(".formcontrol").tooltip({
      position: "bottom left",
      offset: [-2, 10],
      opacity: 0.1
    });

    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
        var target = $(e.target).attr("href");
        //based on what the value of target is, make a selector from 'target'.
        //hide all of the other ones; 
        $("p.explain-search").hide();  
        $(target + '-explain').show();
        console.log("rebuilding the text for the sort portion of the query.");
        buildQuery();
        writeBothCutoffDirections(); 
        //Sync the cutoff direction buttons with the hidden form fields.
    });

    {% include "ss_viewer/showSearchResults.js" %}

</script>
</body>
